# PowerShell Profile for Windows
# This profile works with VS Code terminal, PowerShell terminal, and Command Prompt (if PowerShell is used)

# ===========================
# Utility Aliases
# ===========================

# Alias for grep functionality using Select-String
Set-Alias -Name grep -Value Select-String


# ===========================
# Kafka Aliases
# ===========================

# Start Kafka server using Docker Compose
function cp-kafka-start {
    $dockerComposePath = "d:\Ashish\Repos\cp-kafka-kafdrop"
    Write-Host "Starting Kafka server..." -ForegroundColor Green
    docker-compose -f "$dockerComposePath\docker-compose.yml" up -d
    Write-Host "Kafka server started. Access Kafdrop UI at http://localhost:9000" -ForegroundColor Cyan
    Write-Host "Control Center UI at http://localhost:9021" -ForegroundColor Cyan
}

# Stop Kafka server
function cp-kafka-stop {
    $dockerComposePath = "d:\Ashish\Repos\cp-kafka-kafdrop"
    Write-Host "Stopping Kafka server..." -ForegroundColor Yellow
    docker-compose -f "$dockerComposePath\docker-compose.yml" down
    Write-Host "Kafka server stopped." -ForegroundColor Green
}

# ===========================
# Git Aliases
# ===========================

# Set local git config
function gsetlocal {
    Write-Host "Setting local Git config..." -ForegroundColor Green
    git config user.name "Ashish Patel"
    git config user.email "ashi.patel546@gmail.com"
    Write-Host "Local Git config set:" -ForegroundColor Cyan
    Write-Host "  User: Ashish Patel" -ForegroundColor White
    Write-Host "  Email: ashi.patel546@gmail.com" -ForegroundColor White
}

# Set global git config
function gsetglobal {
    Write-Host "Setting global Git config..." -ForegroundColor Green
    git config --global user.name "Ashish Kumar"
    git config --global user.email "ashish.kumar3@vml.com"
    Write-Host "Global Git config set:" -ForegroundColor Cyan
    Write-Host "  User: Ashish Kumar" -ForegroundColor White
    Write-Host "  Email: ashish.kumar3@vml.com" -ForegroundColor White
}

# ===========================
# Redis Aliases
# ===========================

# Start Redis server using Docker
function redis-server {
    Write-Host "Starting Redis server on port 6379..." -ForegroundColor Green
    docker run -d --name redis-local -p 6379:6379 redis:latest
    Write-Host "Redis server started and exposed on port 6379" -ForegroundColor Cyan
}

# Stop Redis server
function redis-stop {
    # Check if Redis container exists
    $containerStatus = docker ps -a --filter "name=redis-local" --format "{{.Names}}"
    
    if ($containerStatus -eq "redis-local") {
        Write-Host "Stopping Redis server..." -ForegroundColor Yellow
        docker stop redis-local
        docker rm redis-local
        Write-Host "Redis server stopped and removed." -ForegroundColor Green
    }
    else {
        Write-Host "Error: Redis server is not running!" -ForegroundColor Red
        Write-Host "Redis container does not exist." -ForegroundColor Yellow
    }
}

# Access Redis CLI
function redis-cli {
    # Check if Redis container is running
    $containerStatus = docker ps --filter "name=redis-local" --format "{{.Names}}"
    
    if ($containerStatus -eq "redis-local") {
        Write-Host "Connecting to Redis CLI..." -ForegroundColor Green
        docker exec -it redis-local redis-cli
    }
    else {
        Write-Host "Error: Redis server is not running!" -ForegroundColor Red
        Write-Host "Please start Redis server first using 'redis-server' command." -ForegroundColor Yellow
    }
}

# ===========================
# Refresh Function
# ===========================

# Refresh the PowerShell profile to load new aliases
function refresh {
    Write-Host "Refreshing PowerShell profile..." -ForegroundColor Yellow
    . $PROFILE
    Write-Host "Profile refreshed! All aliases are now available." -ForegroundColor Green
}

# ===========================
# Profile Management
# ===========================

# Show all available custom aliases and functions
function aliases {
    Write-Host "`nAvailable custom aliases and functions:" -ForegroundColor Cyan
    Write-Host "========================================" -ForegroundColor Cyan
    Write-Host "  grep           : Alias for Select-String" -ForegroundColor White
    Write-Host "  cp-kafka-start : Start Kafka server" -ForegroundColor White
    Write-Host "  cp-kafka-stop  : Stop Kafka server" -ForegroundColor White
    Write-Host "  gsetlocal      : Set local Git config (Ashish Patel)" -ForegroundColor White
    Write-Host "  gsetglobal     : Set global Git config (Ashish Kumar)" -ForegroundColor White
    Write-Host "  redis-server   : Start Redis server (port 6379)" -ForegroundColor White
    Write-Host "  redis-stop     : Stop Redis server" -ForegroundColor White
    Write-Host "  redis-cli      : Access Redis CLI" -ForegroundColor White
    Write-Host "  refresh        : Reload PowerShell profile" -ForegroundColor White
    Write-Host "  aliases        : Show this list of custom aliases" -ForegroundColor White
    Write-Host "  open-zsh       : Open PowerShell profile for editing" -ForegroundColor White
    Write-Host ""
}

# Open PowerShell profile in default editor
function open-zsh {
    Write-Host "Opening PowerShell profile..." -ForegroundColor Green
    code $PROFILE
}

# ===========================
# Welcome Message
# ===========================

Write-Host "PowerShell profile loaded successfully!" -ForegroundColor Green
Write-Host "Available custom aliases:" -ForegroundColor Cyan
Write-Host "  - grep           : Alias for Select-String" -ForegroundColor White
Write-Host "  - cp-kafka-start : Start Kafka server" -ForegroundColor White
Write-Host "  - cp-kafka-stop  : Stop Kafka server" -ForegroundColor White
Write-Host "  - gsetlocal      : Set local Git config (Ashish Patel)" -ForegroundColor White
Write-Host "  - gsetglobal     : Set global Git config (Ashish Kumar)" -ForegroundColor White
Write-Host "  - redis-server   : Start Redis server (port 6379)" -ForegroundColor White
Write-Host "  - redis-stop     : Stop Redis server" -ForegroundColor White
Write-Host "  - redis-cli      : Access Redis CLI" -ForegroundColor White
Write-Host "  - refresh        : Reload PowerShell profile" -ForegroundColor White
Write-Host ""
